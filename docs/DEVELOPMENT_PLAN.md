# 狗狗百宝箱 - 功能扩展开发计划

> 本文档用于跟踪新功能的开发进度，可在 `状态` 列标注：⬜ 未开始 | 🔄 进行中 | ✅ 已完成

---

## 一、项目概述

**项目名称**: 狗狗百宝箱 (Dog Toolbox)
**当前版本**: v1.0.0
**技术栈**: Python + PyWebView + 原生 HTML/CSS/JavaScript

### 现有模块编号 (M2-M18)
- M2: Base64 / UUID / 命名转换
- M3: JWT 解码
- M4: 时间戳转换
- M5: 哈希计算
- M6: 对称加密
- M7: 文本对比
- M8: Base64↔Hex
- M9: URL 编解码
- M10: 进制转换
- M11: 字符统计
- M12: 密码生成
- M13: JSON 格式化
- M14: 数据格式转换
- M15: 文本处理
- M16: 正则表达式
- M18: cURL 解析 / 颜色转换 / IP工具 / Cron解析 / SQL格式化

### 新功能模块编号规划
- M19: Unicode 编解码
- M20: RSA 非对称加密
- M21: HMAC 计算
- M22: Markdown 预览
- M23: CSV 工具
- M24: HTTP 请求测试
- M25: WebSocket 测试
- M26: Git 命令生成器
- M27: Docker 命令生成器
- M28: JSON Schema 生成
- M29: Mock 数据生成
- M30: 数据脱敏工具
- M31: Excel/CSV 转 JSON
- M32: 日期计算器

---

## 二、功能开发清单

### 2.1 编码转换类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 1 | Unicode 编解码 | M19 | ✅ | 高 | `\u4e2d\u6587` ↔ `中文` 转换，支持 `\uXXXX`、`\xXX`、`&#xXXXX;` 等格式 |

**M19 功能详情：**
- [x] Unicode 转义序列编码 (`\uXXXX`)
- [x] Unicode 转义序列解码
- [x] HTML 实体编码 (`&#xXXXX;` / `&#NNNN;`)
- [x] HTML 实体解码
- [x] 十六进制转义 (`\xXX`)
- [x] 批量处理支持
- [x] 自动检测输入格式

---

### 2.2 加密安全类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 2 | RSA 非对称加密 | M20 | ✅ | 中 | RSA 密钥对生成、公钥加密、私钥解密、签名验签 |
| 3 | HMAC 计算 | M21 | ✅ | 高 | HMAC-MD5/SHA1/SHA256/SHA512 签名计算 |

**M20 功能详情：**
- [x] RSA 密钥对生成 (1024/2048/4096 位)
- [x] 公钥加密
- [x] 私钥解密
- [x] 私钥签名
- [x] 公钥验签
- [x] PEM 格式导入/导出
- [x] PKCS#1 / PKCS#8 格式支持

**M21 功能详情：**
- [x] HMAC-MD5 计算
- [x] HMAC-SHA1 计算
- [x] HMAC-SHA256 计算
- [x] HMAC-SHA512 计算
- [x] 密钥输入 (文本/Hex/Base64)
- [x] 输出格式选择 (Hex/Base64)
- [x] 批量计算支持

---

### 2.3 文本处理类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 4 | Markdown 预览 | M22 | ✅ | 中 | 实时预览 Markdown 渲染效果，支持 GFM 语法 |
| 5 | CSV 工具 | M23 | ✅ | 中 | CSV 查看、编辑、转换，支持自定义分隔符 |

**M22 功能详情：**
- [x] 实时 Markdown 渲染预览
- [x] GFM (GitHub Flavored Markdown) 支持
- [x] 代码块语法高亮
- [x] 表格渲染
- [x] 任务列表支持
- [ ] 导出为 HTML（后端已完成，待 UI 集成）
- [ ] 分屏编辑/预览模式（待 UI 实现）

**M23 功能详情：**
- [x] CSV 文件解析与表格展示
- [x] 自定义分隔符 (逗号/制表符/分号等)
- [x] 列排序与筛选（后端已完成）
- [ ] 单元格编辑（待 UI 实现）
- [x] CSV ↔ JSON 转换
- [x] CSV ↔ TSV 转换
- [ ] 导出功能（待 UI 实现）

---

### 2.4 网络开发类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 6 | HTTP 请求测试 | M24 | ⬜ | 高 | 类似简化版 Postman，支持 GET/POST/PUT/DELETE 等 |
| 7 | WebSocket 测试 | M25 | ⬜ | 中 | WebSocket 连接测试，消息收发 |

**M24 功能详情：**
- [ ] HTTP 方法支持 (GET/POST/PUT/DELETE/PATCH/HEAD/OPTIONS)
- [ ] 请求头编辑
- [ ] Query 参数编辑
- [ ] 请求体编辑 (JSON/Form/Raw)
- [ ] 响应展示 (Headers/Body/状态码/耗时)
- [ ] JSON 响应自动格式化
- [ ] 请求历史记录
- [ ] 请求保存与管理
- [ ] cURL 导入/导出

**M25 功能详情：**
- [ ] WebSocket 连接建立
- [ ] 自定义请求头
- [ ] 消息发送 (文本/JSON)
- [ ] 消息接收与展示
- [ ] 连接状态显示
- [ ] 消息历史记录
- [ ] 自动重连选项
- [ ] Ping/Pong 支持

---

### 2.5 命令生成类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 8 | Git 命令生成器 | M26 | ✅ | 中 | 可视化生成常用 Git 命令 |
| 9 | Docker 命令生成器 | M27 | ✅ | 中 | docker/docker-compose/docker service/docker stack 命令生成 |

**M26 功能详情：**
- [x] 基础命令 (init/clone/add/commit/push/pull)
- [x] 分支操作 (branch/checkout/merge/rebase)
- [x] 远程操作 (remote/fetch)（后端已完成）
- [x] 撤销操作 (reset/revert/checkout)
- [x] 日志查看 (log/diff/show)
- [x] 标签操作 (tag)（后端已完成）
- [x] 暂存操作 (stash)
- [x] 命令说明与示例
- [x] 一键复制
- [x] **完整 UI 实现**（8 个场景标签：提交、分支、日志、重置、克隆、合并、暂存、常用命令）
- [x] **动态表单显示**（根据操作类型自动显示/隐藏相关字段）
- [x] **实时命令预览**（参数变化即时更新命令输出和说明）
- [x] **参数验证**（必填项检查、格式验证）

**M27 功能详情：**
- [x] **docker 命令**
  - [x] run (端口/卷/环境变量/网络/重启策略/资源限制等)
  - [x] build (构建路径/标签/Dockerfile/构建参数/多阶段构建等)
  - [x] exec (容器内执行命令/交互模式/工作目录/用户等)
  - [x] logs (日志查看/跟踪/时间戳/行数限制等)
  - [x] ps (容器列表/过滤条件)
  - [x] images (镜像列表/过滤条件)
  - [x] container (启动/停止/重启/删除等容器管理)
- [x] **docker-compose 命令**
  - [x] up/down (启动/停止服务)
  - [x] start/stop/restart (服务管理)
  - [x] build (构建服务)
  - [x] logs (查看日志)
  - [x] ps (列出容器)
  - [x] exec (执行命令)
  - [x] pull (拉取镜像)
- [x] **docker service 命令** (Swarm)（后端已完成）
  - [x] create/update/scale
  - [x] ls/ps/logs
  - [x] rm
- [x] **docker stack 命令** (Swarm)（后端已完成）
  - [x] deploy
  - [x] ls/ps/services
  - [x] rm
- [x] **完整 UI 实现**（8 个场景标签）
- [x] **表单式参数输入**（端口映射、卷挂载、环境变量等可视化配置）
- [x] **实时命令预览**
- [x] **动态表单**（根据操作类型显示不同字段）
- [x] 命令预览与复制

---

### 2.6 数据处理类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 10 | JSON Schema 生成 | M28 | ✅ | 中 | 从 JSON 数据自动生成 JSON Schema |
| 11 | Mock 数据生成 | M29 | ✅ | 中 | 生成测试用的假数据 |
| 12 | 数据脱敏工具 | M30 | ✅ | 高 | 手机号、身份证、邮箱等敏感信息脱敏 |
| 13 | Excel/CSV 转 JSON | M31 | ✅ | 中 | 表格数据转 JSON，支持文件上传 |

**M28 功能详情：**
- [x] JSON 输入解析
- [x] 自动推断数据类型
- [x] 生成 JSON Schema (Draft-07)
- [x] 支持嵌套对象和数组
- [ ] 可选字段标记
- [ ] 枚举值推断
- [x] Schema 格式化输出
- [ ] 复制/下载 Schema

**M29 功能详情：**
- [x] 基础类型 (字符串/数字/布尔)
- [x] 中文姓名生成
- [x] 手机号生成
- [x] 邮箱生成
- [x] 身份证号生成
- [x] 地址生成
- [x] 日期时间生成
- [x] UUID 生成
- [x] 自定义模板
- [x] 批量生成 (指定数量)
- [x] JSON/CSV/SQL/JSON Lines 格式输出（后端已完成）

**M30 功能详情：**
- [x] 手机号脱敏 (138****8888)
- [x] 身份证脱敏 (110***********1234)
- [x] 邮箱脱敏 (a**@example.com)
- [x] 银行卡脱敏
- [x] 姓名脱敏 (张**)
- [x] 地址脱敏（后端已完成）
- [x] 自定义脱敏规则
- [x] 批量处理
- [x] JSON 递归脱敏（后端已完成）

**M31 功能详情：**
- [x] CSV 文件上传解析
- [ ] Excel 文件上传解析 (.xlsx)（后端已完成，待 UI 集成）
- [x] 预览表格数据
- [ ] 选择转换的列（后端已完成，待 UI 集成）
- [ ] 设置字段映射（后端已完成，待 UI 集成）
- [x] 生成 JSON 数组
- [ ] 生成嵌套 JSON 结构（后端已完成，待 UI 集成）
- [ ] 复制/下载结果（待 UI 实现）

---

### 2.7 实用工具类

| # | 功能名称 | 模块 | 状态 | 优先级 | 说明 |
|---|---------|------|------|--------|------|
| 14 | 日期计算器 | M32 | ✅ | 高 | 日期差值计算、日期加减、工作日计算 |

**M32 功能详情：**
- [x] 两个日期之间的差值 (天/周/月/年)
- [x] 日期加减运算 (加/减 N 天/周/月/年)
- [x] 工作日计算 (排除周末)（后端已完成）
- [ ] 节假日支持 (可选)（待实现）
- [x] 周数计算
- [x] 季度计算（后端已完成）
- [x] 闰年判断
- [x] 星期几查询

---

## 三、开发规范

### 3.1 文件命名规范
```
web/tools_mXX_utils.js    # 工具算法模块
tests/mXX_utils.test.js   # 单元测试文件
```

### 3.2 模块结构模板
```javascript
/* 工具箱（MXX）功能名称
 * 设计目标：
 * - 纯算法、无 DOM 依赖
 * - 输入输出统一按 UTF-8 处理
 */
(function (root, factory) {
    if (typeof module !== 'undefined' && module.exports) {
        module.exports = factory();
    } else {
        root.DogToolboxMXXUtils = factory();
    }
})(typeof globalThis !== 'undefined' ? globalThis : this, function () {
    'use strict';
    // 实现代码
    return { /* 导出的函数 */ };
});
```

### 3.3 需要修改的文件清单
每个新功能需要修改/新增以下文件：

| 文件 | 说明 |
|------|------|
| `web/tools_mXX_utils.js` | 新增：工具算法模块 |
| `web/index.html` | 修改：添加导航项和页面结构 |
| `web/app.js` | 修改：添加初始化函数和事件处理 |
| `web/styles.css` | 修改：添加工具特定样式（如需要） |
| `tests/mXX_utils.test.js` | 新增：单元测试 |

---

## 四、依赖库规划

| 功能 | 推荐库 | 引入方式 | 说明 |
|------|--------|----------|------|
| Markdown 预览 | marked.js | CDN | 轻量级 Markdown 解析器 |
| 代码高亮 | highlight.js | CDN | Markdown 代码块高亮 |
| Excel 解析 | SheetJS (xlsx) | CDN | Excel 文件读取 |
| RSA 加密 | Web Crypto API | 原生 | 浏览器内置，无需引入 |
| HMAC 计算 | Web Crypto API | 原生 | 浏览器内置，无需引入 |

---

## 五、开发优先级排序

### 第一批（高优先级）
1. ✅ Unicode 编解码 (M19) - 编码工具补充
2. ✅ HMAC 计算 (M21) - API 签名常用
3. ✅ 数据脱敏工具 (M30) - 数据处理刚需
4. ✅ 日期计算器 (M32) - 日常使用频繁
5. ⬜ HTTP 请求测试 (M24) - 开发调试必备

### 第二批（中优先级）
6. ✅ RSA 非对称加密 (M20)
7. ✅ Markdown 预览 (M22)
8. ✅ CSV 工具 (M23)
9. ✅ JSON Schema 生成 (M28)
10. ✅ Mock 数据生成 (M29)

### 第三批（完善功能）
11. ⬜ WebSocket 测试 (M25)
12. ✅ Git 命令生成器 (M26) **UI 完成 + Codex 审核通过**
13. ✅ Docker 命令生成器 (M27) **UI 完成 + Codex 审核通过**
14. ✅ Excel/CSV 转 JSON (M31)

---

## 六、进度跟踪

| 日期 | 完成功能 | 备注 |
|------|----------|------|
| 2025-12-15 | M19 Unicode 编解码 | ✅ 完成 |
| 2025-12-15 | M20 RSA 非对称加密 | ✅ 完成 |
| 2025-12-15 | M21 HMAC 计算 | ✅ 完成 |
| 2025-12-15 | M23 CSV 工具 | ✅ 完成 |
| 2025-12-15 | M31 Excel/CSV 转 JSON | ✅ 完成 |
| 2025-12-15 | M32 日期计算器 | ✅ 完成 |
| 2025-12-15 | M22 Markdown 预览 | ✅ **完整实现**：实时渲染、GFM 支持、代码高亮、表格渲染 |
| 2025-12-15 | M26 Git 命令生成器 | ✅ **UI 完成**：8 个场景标签、动态表单、实时预览、参数验证。Codex 审核通过 |
| 2025-12-15 | M27 Docker 命令生成器 | ✅ **UI 完成**：8 个场景标签、表单式参数配置、实时命令预览。Codex 审核通过 |
| 2025-12-15 | M28 JSON Schema 生成 | ✅ **完整实现**：JSON 解析、类型推断、Schema 生成、嵌套支持 |
| 2025-12-15 | M29 Mock 数据生成 | ✅ **完整实现**：中文姓名、手机号、邮箱、身份证、UUID 等数据生成 |
| 2025-12-15 | M30 数据脱敏工具 | ✅ **完整实现**：手机号、身份证、邮箱、银行卡、姓名等脱敏 |
| 2025-12-15 | 代码质量优化 | ✅ **统一复制交互逻辑**：`copyToolText()` 支持文本反馈和 CSS 动画两种模式 |
| 2025-12-15 | 代码质量优化 | ✅ **修复 event 参数依赖**：`switchGitScene` 和 `switchDockerScene` 添加显式参数，避免 ReferenceError |
| 2025-12-16 | Bug 修复 | ✅ **M23 CSV 工具完善**：添加完整 UI 实现（98 行），补全 `initCsvTool()`、`setCsvInputFormat()`、`setCsvOutputFormat()`、`updateCsvToolUi()`、`updateCsvTool()`、`clearCsvTool()`、`copyCsvOutput()` 等函数 |
| 2025-12-16 | 功能优化 | ✅ **M23/M31 功能区分**：修改 M23 标题为"CSV 文本格式化"（副标题：CSV 文本转换、分隔符调整与 JSON 互转），明确与 M31"Excel/CSV 转 JSON"（表格数据转换器）的定位差异 |
| 2025-12-16 | UI 修复 | ✅ **Git/Docker 命令展示框优化**：添加专用 CSS 样式（26 行），设置 `min-height: 120px`，改善命令预览区域的显示效果 |
| 2025-12-16 | 系统优化 | ✅ **进程清理机制**：为 3 个项目（doggy-toolbox、meow-piggy-bank、moo-todo）的 `main.py` 添加 `sys.exit()` 调用，确保应用窗口关闭后 Python 进程正确退出，消除残留进程问题 |
| 2025-12-16 | Bug 修复 | ✅ **M22 XSS 安全漏洞**：修复 Markdown 链接中的 `javascript:` 协议 XSS 漏洞，危险链接替换为 `#unsafe-url-removed` |
| 2025-12-16 | UI 修复 | ✅ **M22 删除重复按钮**：删除 Markdown 预览页面中重复的"导出 HTML"和"复制 HTML"按钮 |
| 2025-12-16 | 功能修复 | ✅ **添加 6 个缺失的初始化函数**：M22/M26/M27/M28/M29/M30 添加 `init*Tool()` 函数，修复工具无法使用的问题 |
| 2025-12-16 | Bug 修复 | ✅ **M31 API 不一致修复**：修复 `app.js:3776` 调用 `tableToJson()` 参数不匹配问题，改为使用 options 对象 |
| 2025-12-16 | 功能完善 | ✅ **M29 格式化输出**：添加 `formatOutput()` 函数，支持 json/jsonlines/csv/sql 四种格式输出 |
| 2025-12-16 | 功能完善 | ✅ **M30 地址脱敏与 JSON 递归脱敏**：添加 `maskAddress()` 和 `maskJsonRecursive()` 函数，支持地址脱敏和 JSON 对象递归脱敏 |
| 2025-12-16 | 功能完善 | ✅ **M23 表格操作**：添加 `sortTable()` 和 `filterTable()` 函数，支持按列排序和关键词过滤 |
| 2025-12-16 | 功能完善 | ✅ **M26 Git 远程与标签**：添加 `generateRemoteCommand()`、`generateFetchCommand()`、`generateTagCommand()` 函数 |
| 2025-12-16 | 功能完善 | ✅ **M27 Docker Swarm**：添加 `generateServiceCommand()` 和 `generateStackCommand()` 函数，支持 Swarm 集群管理 |
| 2025-12-16 | 功能完善 | ✅ **M32 工作日与季度**：添加 `calculateWorkingDays()`、`addWorkingDays()`、`getQuarter()` 函数 |
| 2025-12-16 | 代码质量 | ✅ **Codex Review 两轮**：完成两批次代码审查，修复 maskJsonRecursive 字段匹配问题、M32 日期验证问题等 |
| 2025-12-16 | 测试验证 | ✅ **单元测试**：创建 test_batch1.js 和 test_batch2.js，所有测试通过 |

---

## 九、下周开发计划（2025-12-17 起）

### 9.1 本周待完成任务（优先级：高）

| 任务 | 模块 | 难度 | 预估时间 | 说明 |
|------|------|------|----------|------|
| M29 输出格式选择 | M29 | 简单-中等 | 60-120 分钟 | 添加 JSON 数组/CSV/JSON Lines 输出格式选择 |
| M30 智能识别脱敏 | M30 | 简单 | 30-60 分钟 | UI 暴露已有的 `smartMask/detectType` 功能 |
| M23 自动检测分隔符 | M23 | 简单 | 45-90 分钟 | 添加自动检测分隔符和一键切换 CSV↔TSV 功能 |

### 9.2 下周计划任务（优先级：中）

| 任务 | 模块 | 难度 | 预估时间 | 说明 |
|------|------|------|----------|------|
| M22 代码高亮 | M22 | 简单-中等 | 2-4 小时 | 集成 Prism.js 实现代码块语法高亮 |
| M30 JSON 脱敏 | M30 | 中等 | 4-8 小时 | 支持 JSON/日志的结构化递归脱敏 + 规则库 |
| M26/M27 模板管理 | M26/M27 | 简单-中等 | 2-6 小时 | 常用场景模板库 + 自定义模板保存 |

### 9.3 长期计划任务（优先级：低）

| 任务 | 模块 | 难度 | 预估时间 | 说明 |
|------|------|------|----------|------|
| M31 Excel 支持 | M31 | 困难 | 1-3 天 | 真实 .xlsx 文件解析 + 字段映射 + 类型推断 |
| M28 Schema 增强 | M28 | 中等 | 4-12 小时 | 更准确推断（optional/enum）+ 与 M29 联动 |
| M24 HTTP 请求测试 | M24 | 中等-困难 | 1-2 天 | 类似简化版 Postman 的 HTTP 测试工具 |
| M25 WebSocket 测试 | M25 | 中等 | 1 天 | WebSocket 连接测试与消息收发 |

---

## 七、备注

- 所有新功能应遵循现有代码风格和架构模式
- 优先使用浏览器原生 API，减少外部依赖
- 每个功能完成后应编写对应的单元测试
- 复杂功能可拆分为多个子任务逐步完成

---

## 八、已知风险与待改进项

### 8.1 Codex 代码审查识别的风险（2025-12-15）

#### ⚠️ 高风险：Web Crypto API 环境依赖

**影响模块**：M20 (RSA 非对称加密)、M21 (HMAC 计算)

**问题描述**：
- 这两个模块依赖 `crypto.subtle` API（Web Crypto API）
- 在非 HTTPS 环境（如 `http://localhost` 或 `file://`）下，`crypto.subtle` 可能为 `undefined`
- 用户在非安全上下文中使用时会直接报错："当前环境不支持 Web Crypto API"

**当前状态**：
- ✅ 代码已包含环境检测和错误提示
- ❌ 缺少降级方案（如使用纯 JS 实现的加密库）

**改进建议**：
1. **短期**：在工具页面顶部添加明显的环境要求提示（需 HTTPS 或 localhost）
2. **中期**：考虑集成纯 JS 加密库作为降级方案（如 crypto-js）
3. **长期**：PyWebView 应用中应该不受此限制，仅浏览器环境需注意

**优先级**：中（暂不影响主要使用场景，因为 PyWebView 本地应用环境支持）

---

#### ⚠️ 中风险：日期计算月末行为

**影响模块**：M32 (日期计算器)

**问题描述**：
- `dateAdd` 函数使用 JavaScript 原生 `Date.setMonth()`
- 在月末日期加减月份时，会自动溢出到下个月
- 示例：`2024-01-31 + 1个月 = 2024-03-02`（而不是期望的 `2024-02-29`）

**当前状态**：
- ✅ 这是 JavaScript `Date` 对象的标准行为
- ❌ 用户可能对结果感到困惑

**改进建议**：
1. **UI 提示**：在日期加减区域添加说明文字："月末日期加减月份时可能产生溢出"
2. **增强功能**：提供"锁定月末"选项（加减月份时始终取目标月的最后一天）
3. **文档说明**：在用户手册中说明此行为

**优先级**：低（属于已知的 JS Date 行为，用户可通过其他计算方式规避）

---

#### ✅ 已修复：重复页面 ID

**影响模块**：M28 (JSON Schema 生成)

**问题描述**：
- `web/index.html` 中存在两个 `id="page-tool-json-schema"` 的 section
- 导致页面导航失败和事件绑定冲突

**修复方案**：
- ✅ 删除第一个无效页面（使用不存在的函数 `generateJsonSchema()`、`validateWithJsonSchema()`）
- ✅ 保留第二个有效页面（使用 `updateJsonSchemaTool()`、`copyJsonSchemaOutput()`）

**修复日期**：2025-12-15
**验证状态**：✅ Codex 二次审查通过

---

#### ✅ 已修复：M32 属性名不匹配

**影响模块**：M32 (日期计算器)

**问题描述**：
- UI 代码使用 `weekday.cnName/enName` 访问属性
- 但 API 返回的对象属性为 `weekday.nameCn/nameEn`
- 导致星期标签显示 `undefined`

**修复方案**：
- ✅ 修改 `web/app.js` 第 1601、1631 行
- ✅ 将属性访问改为正确的 `nameCn` 和 `nameEn`

**修复日期**：2025-12-15
**验证状态**：✅ Codex 二次审查通过

---

#### ✅ 已修复：空指针风险

**影响模块**：M32 (日期计算器)

**问题描述**：
- `clearDateCalcTool()` 直接访问 DOM 元素而无空指针检查
- 若元素不存在会导致运行时错误

**修复方案**：
- ✅ 为 `datecalc-add-value` 和 `datecalc-add-unit` 添加空指针检查

**修复日期**：2025-12-15
**验证状态**：✅ Codex 二次审查通过
